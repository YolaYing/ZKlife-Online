import { Bytes } from "../../common/type";
import {
  read_public_bytes_from_u64,
  read_public_len_then_bytes,
  // @ts-ignore
  require,
} from "../../common/zkwasm";
import { handleFunc } from './register';
import { readBlocks } from "./readblock";

export function zkmain_lib(): void {

  let blocks = readBlocks();

  const blockhash_latest = read_public_bytes_from_u64(32);

  const expected_state = read_public_len_then_bytes();

  const state: Bytes = handleFunc(blocks) as Bytes;

  require(state == expected_state ? 1 : 0);
}

export function asmain_lib(): Uint8Array {

  let blocks = readBlocks();

  const blockhash_latest = read_public_bytes_from_u64(32);

  const state: Bytes = handleFunc(blocks) as Bytes;

  return state as Uint8Array;
}
